# TBlocker Webhook Relay

–ù–µ–±–æ–ª—å—à–æ–π FastAPI-—Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏ –æ—Ç [xray-torrent-blocker](https://github.com/kutovoys/xray-torrent-blocker),
–¥–æ—Å—Ç–∞–µ—Ç –∏–∑ –Ω–∏—Ö Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–º—É –ø–æ–Ω—è—Ç–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∑–∞ —Ç–æ—Ä—Ä–µ–Ω—Ç-—Ç—Ä–∞—Ñ–∏–∫.
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç —É–≤–µ–¥–æ–º–ª—è—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `TELEGRAM_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥—É—Ç —É—Ö–æ–¥–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.
- `ADMIN_CHAT_ID` ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ. –ï—Å–ª–∏ –∑–∞–¥–∞–Ω, —Å—é–¥–∞ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è —Å–ª—É–∂–µ–±–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
  –ë–µ–∑ —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `chat_id`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à—ë–ª –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –≤–µ–±—Ö—É–∫–µ.

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example` –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º.

## –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:8000/webhook`.

## –ó–∞–ø—É—Å–∫ –≤ Docker

```bash
docker build -t tblocker-webhook .
docker run -d --name tblocker-webhook \
  -p 8000:8000 \
  --env-file .env \
  tblocker-webhook
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –≤ tblocker

```yaml
# Webhook configuration
SendWebhook: true
WebhookURL: "http://domen.com:8000/webhook"
WebhookHeaders:
  Content-Type: "application/json"
WebhookTemplate: >-
  {"chat_id":"112312414","text":"üö´ tblocker\\nüë§ user: %s\\nüåê ip: %s\\nüñ•Ô∏è server: %s\\n‚ö° action: %s\\n‚è≥ ttl(s): %d\\nüïí time: %s"}
```

- `%s %s %s %s %d %s` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã tblocker.
- `chat_id` –≤ —à–∞–±–ª–æ–Ω–µ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Äî —Å–µ—Ä–≤–∏—Å –≤—Å—ë —Ä–∞–≤–Ω–æ –≤–æ–∑—å–º—ë—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π ID –∏–∑ –ø–æ–ª—è `user`.

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–∏—Å

1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç POST-–∑–∞–ø—Ä–æ—Å –æ—Ç tblocker.
2. –†–∞–∑–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `user_XXXXXXXX`.
3. –£–¥–∞–ª—è–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å `user_` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä—è–º–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
4. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥—É–±–ª–∏—Ä—É–µ—Ç —Ç–µ—Ö. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.

## –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
curl -X POST http://localhost:8000/webhook \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": "2104519441",
    "text": "?? tblocker\n?? user: user_2104519441\n?? ip: 176.109.188.156\n??? server: example-server\n? action: block\n? ttl(s): 60\n?? time: 2025-10-09T22:29:21Z"
  }'
```
